<!DOCTYPE html><html lang="es"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Carrito | Master Fibra</title><link rel="stylesheet" href="./style.css"></head><body>

<div class="navbar"><div class="container nav-inner">
  <a href="./index.html" class="brand"><img src="./images/logo.webp" alt="Master Fibra"><strong>Master Fibra</strong></a>
  <div class="nav-links">
    <a href="./index.html">Inicio</a>
    <a href="./shop.html">Tienda</a>
    <a href="./contacto.html">Contacto</a>
    <a href="./carrito.html" class="cart">üõí <span id="cart-count" class="badge count">0</span></a>
  </div>
</div></div>

<div class="container section"><div class="breadcrumb"><a href="./index.html">Inicio</a> / Carrito</div>
<h2>Tu carrito</h2><div id="cart-view"></div>

<div style="margin-top:40px; text-align:center;" id="cta-buttons-section">
    <h3 style="color:var(--blue)">Finaliza tu pedido y reg√≠stralo</h3>
    <p style="margin-bottom:15px">Haz clic en el bot√≥n para ser redirigido a nuestro Formulario de Pedidos, donde los productos y el total ya estar√°n rellenados autom√°ticamente.</p>

    <a class="btn btn-primary" id="btn-finalizar-registro" target="_blank" style="font-size: 1.1em; padding: 14px 24px;">üìù IR A REGISTRAR PEDIDO</a>
    
    <div style="margin-top:20px;">
        <a class="btn btn-outline" id="btn-whatsapp-contacto" target="_blank">üí¨ Contactar por WhatsApp (sin env√≠o de pedido)</a>
    </div>
</div>
</div>
<script>
// El resto de las funciones (loadCart, saveCart, setQty, etc.) est√°n en app.js y funcionan correctamente.

function navigateToShop() {
    window.location.href = './shop.html';
}

function renderCart(){
  const c=loadCart(); 
  const cartView = document.getElementById('cart-view');
  const ctaSection = document.getElementById('cta-buttons-section');
  
  if(!c.length){
    // Carrito vac√≠o: Ocultar la secci√≥n de botones y mostrar mensaje vac√≠o
    cartView.innerHTML='<div class="empty">Tu carrito est√° vac√≠o.</div>'; 
    if(ctaSection) ctaSection.style.display = 'none';
    return;
  }
  
  // Carrito con items: Mostrar carrito y botones
  if(ctaSection) ctaSection.style.display = 'block';

  let html='<table><thead><tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Total</th><th></th></tr></thead><tbody>';
  c.forEach(i=>{ html+=`<tr><td>${i.name}</td><td>$${i.price.toFixed(2)}</td><td><input type="number" min="1" value="${i.qty}" style="width:80px" onchange="setQty('${i.id}',parseInt(this.value))"></td><td>$${(i.price*i.qty).toFixed(2)}</td><td><button class="btn btn-outline" onclick="removeFromCart('${i.id}')">Quitar</button></td></tr>` });
  
  const total=cartTotal(c); 
  html+='</tbody></table><div style="text-align:right;margin-top:12px;font-weight:700">Total: $'+total.toFixed(2)+'</div>';
  cartView.innerHTML=html;

  // Asignar los enlaces a los botones
  const btnFinalizar = document.getElementById('btn-finalizar-registro');
  const btnWhatsApp = document.getElementById('btn-whatsapp-contacto');
  
  if(btnFinalizar) btnFinalizar.href = googleFormsLink(total);
  if(btnWhatsApp) btnWhatsApp.href = 'https://wa.me/593995783624?text=Hola%2C%20quisiera%20informaci%C3%B3n%20sobre%20un%20pedido.';
}

function clearCartAndShowSuccess() {
    const c = loadCart();
    
    // 1. VACIAR EL CARRITO AUTOM√ÅTICAMENTE
    if (c.length > 0) {
        saveCart([]); // Vac√≠a el carrito en localStorage y actualiza el contador
    }

    // 2. MOSTRAR MENSAJE DE √âXITO
    document.querySelector('.section h2').textContent = 'Pedido Enviado con √âxito';
    document.getElementById('cart-view').innerHTML = `
        <div class="empty" style="border: 1px solid #1f9d55; background: #e6ffed; color: #1f9d55;">
            <h3>üéâ ¬°Gracias por tu pedido!</h3>
            <p>Hemos recibido tu pedido correctamente. Pronto nos pondremos en contacto contigo para confirmar la disponibilidad y el env√≠o.</p>
            <div style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="navigateToShop()">Ir a la Tienda</button>
            </div>
        </div>
    `;
    
    // 3. Ocultar los botones de finalizar y contacto para evitar confusi√≥n
    const ctaSection = document.getElementById('cta-buttons-section');
    if(ctaSection) ctaSection.style.display = 'none';

    // 4. Limpiar la URL para evitar que el mensaje se repita al recargar
    history.replaceState(null, '', window.location.pathname);
}

document.addEventListener('DOMContentLoaded', () => {
    // 1. Obtener par√°metros de la URL
    const urlParams = new URLSearchParams(window.location.search);
    
    // 2. Comprobar si venimos de un env√≠o exitoso del formulario
    if (urlParams.get('order') === 'sent') {
        clearCartAndShowSuccess();
    } else {
        // Si no hay par√°metro de √©xito, renderizar el carrito normal
        renderCart();
    }
});
</script>


<div class="footer-top">
  <div class="container">
    <div class="icons">
      <a class="icon-btn fb" href="https://www.facebook.com/masterfibraec" target="_blank" title="Facebook" aria-label="Facebook">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M279.14 288l14.22-92.66h-88.91V129.09c0-25.35 12.42-50.06 52.24-50.06H293V6.26S259.91 0 225.36 0c-73.22 0-121.09 44.38-121.09 124.72V195.3H22.89V288h81.38v224h100.2V288z"/></svg>
      </a>
      <a class="icon-btn ig" href="https://www.instagram.com/master_fibra" target="_blank" title="Instagram" aria-label="Instagram">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224 128c-70.7 0-128 57.3-128 128s57.3 128 128 128 128-57.3 128-128S294.7 128 224 128zm0 208c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80zM394.7 124.3c0 16.4-13.3 29.7-29.7 29.7s-29.7-13.3-29.7-29.7 13.3-29.7 29.7-29.7 29.7 13.3 29.7 29.7zM448 80v352c0 44.2-35.8 80-80 80H80c-44.2 0-80-35.8-80-80V80C0 35.8 35.8 0 80 0h288c44.2 0 80 35.8 80 80z"/></svg>
      </a>
    </div>
  </div>
</div>

</div>
<div class="footer"><div class="container">¬© 2025 Master Fibra de Vidrio ‚Äì Sitio desarrollado por Ing. Elvis G√≥mez</div></div>
<script src="./app.js"></script>

</body></html>